"use strict";Array.prototype.find||(Array.prototype.find=function(t){if(null===this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof t)throw new TypeError("predicate must be a function");for(var e,n=Object(this),l=n.length>>>0,a=arguments[1],o=0;o<l;o++)if(e=n[o],t.call(a,e,o,n))return e}),Array.prototype.findIndex||(Array.prototype.findIndex=function(t){if(null===this)throw new TypeError("Array.prototype.findIndex called on null or undefined");if("function"!=typeof t)throw new TypeError("predicate must be a function");for(var e,n=Object(this),l=n.length>>>0,a=arguments[1],o=0;o<l;o++)if(e=n[o],t.call(a,e,o,n))return o;return-1});var tbHelper={emptyPages:["blank","empty","no_text"],panelSeparators:[{label:"Long dash",value:"–"},{label:"Single dash",value:"-"},{label:"Double dash",value:"--"},{label:"Equal sign",value:"="}],styleProps:{keyword:{label:"Keyword",def:null},layerGroup:{label:"Layer Group",def:null},fontName:{label:"Font Name",values:[],def:"ArialMT"},size:{label:"Size",def:25,min:1,max:1e3},leading:{label:"Leading",def:0,min:0,max:1e3},tracking:{label:"Tracking",def:0,min:-1e3,max:1e4},vScale:{label:"VScale",def:100,min:1,max:1e3},hScale:{label:"HScale",def:100,min:1,max:1e3},capitalization:{label:"Capitalization",values:[{value:"ALLCAPS",label:"All caps"},{value:"NORMAL",label:"Normal"},{value:"SMALLCAPS",label:"Small caps"}],def:"NORMAL"},justification:{label:"Justification",values:[{value:"CENTER",label:"Center"},{value:"CENTERJUSTIFIED",label:"Center justified"},{value:"FULLYJUSTIFIED",label:"Fully justified"},{value:"LEFT",label:"Left"},{value:"LEFTJUSTIFIED",label:"Left justified"},{value:"RIGHT",label:"Right"},{value:"RIGHTJUSTIFIED",label:"Right justified"}],def:"CENTER"},antialias:{label:"Antialias",values:[{value:"CRISP",label:"Crisp"},{value:"SHARP",label:"Sharp"},{value:"SMOOTH",label:"Smooth"},{value:"STRONG",label:"Strong"},{value:"NONE",label:"None"}],def:"SMOOTH"},fauxBold:{label:"FauxBold",def:!1},fauxItalic:{label:"FauxItalic",def:!1},hyphenate:{label:"Hyphenate",def:!0},kerning:{label:"Kerning",values:[{value:"METRICS",label:"Metrics"},{value:"OPTICAL",label:"Optical"}],def:"METRICS"}},getDefaultTextReplaceRules:function(){return[{id:this.uniqueId(),pattern:"‘|’",to:"'",regex:!0,regexG:!0,regexI:!1,active:!0},{id:this.uniqueId(),pattern:"“|”",to:'"',regex:!0,regexG:!0,regexI:!1,active:!0},{id:this.uniqueId(),pattern:"?!",to:"!?",regex:!1,regexG:!0,regexI:!1,active:!0},{id:this.uniqueId(),pattern:"\\.{3,}",to:"...",regex:!0,regexG:!0,regexI:!1,active:!0},{id:this.uniqueId(),pattern:"…",to:"...",regex:!0,regexG:!0,regexI:!1,active:!0}]},getSylePropValues:function(t){for(var e=[],n=0;n<this.styleProps[t].values.length;n++)e.push(styleProps[t].values[n].value);return e},uniqueId:function(){var t=16,e="";e+=(new Date).getTime().toString(36)+"_";do e+=Math.floor(35*Math.random()).toString(36);while(e.length<t);return e},getDummyStyle:function(t){var e={};for(var n in this.styleProps)e[n]=this.styleProps[n].def;return t&&(e.keyword=t),e},getDummyStyleSet:function(t){var e={id:this.uniqueId(),name:null,styles:[this.getDummyStyle("default_style")]};return t&&(e.name=t),e},getDummyTextReplaceRule:function(){return{id:this.uniqueId(),pattern:"",to:"",regex:!1,regexG:!1,regexI:!1,active:!0}},checkStyleSet:function(t){var e=0;if(void 0==t.name||!t.name||!t.name.trim())throw"Styleset must have a name";if(t.name.length>25)throw"Styleset name must be less than 25 characters";if(!t.styles)throw"No styles in set";for(var n=0;n<t.styles.length;n++){if(!t.styles[n].keyword)throw"Some style keywords are undefined";t.styles[n].keyword=t.styles[n].keyword.trim().toLowerCase(),"default_style"==t.styles[n].keyword&&e++}if(0===e)throw"Missing default_style";if(e>1)throw"Only one default_style allowed";t.styles.sort(function(t,e){return t.keyword<e.keyword?-1:t.keyword>e.keyword?1:0});for(var n=0;n<t.styles.length;n++)if(void 0!=t.styles[n+1]&&t.styles[n].keyword==t.styles[n+1].keyword)throw"The styleset contains duplicate style keywords";for(var n=0;n<t.styles.length;n++)t.styles[n]=this.cleanStyle(t.styles[n])},cleanStyle:function(t){for(var e in this.styleProps)void 0!=t[e]&&null!==t[e]||(t[e]=this.styleProps[e].def);return t},cleanTextReplaceRules:function(t){for(var e=[],n=0;n<t.length;n++){var l=this.getDummyTextReplaceRule();for(var a in l)if("id"!=a){if(("pattern"==a||"to"==a)&&void 0==t[n][a])throw a+" is missing";"active"==a&&void 0==t[n][a]?l[a]=!0:l[a]=void 0!=t[n][a]&&t[n][a]}e.push(l)}return e},getStyleFromStyleSet:function(t,e){if(!t)throw"No style set";if(!t.styles)throw"No styles in set";var n=t.styles.find(function(t){return t.keyword==e.toLowerCase()});if(n)return this.cleanStyle(n);throw"Style not found"},getFilePageNumber:function(t){var e=/^.*[-_\ ]([\d]{3,4}-[\d]{3,4})\.psd$/,n=e.exec(t);return n&&n[1]?n[1]:(e=/^.*[-_\ ]([\d]{3,5})\.psd$/,n=e.exec(t),n&&n[1]?n[1]:null)},getPageNumbers:function(t){for(var e,n=[],l=/\b([\d-]{3,9})#/g;null!==(e=l.exec(t));)e.index===l.lastIndex&&l.lastIndex++,n.push(e[1]);n.sort();for(var a=0;a<n.length-1;a++)if(n[a]==n[a+1])throw"Duplicate page number: "+n[a];return n},loadPage:function(t,e){var n=new RegExp("\\b"+e+"#\\ ?(.*)?\\n([\\s\\S]*?)($|END|[\\d-]{3,9}#)"),l=n.exec(t);return l?l:null},pageContainsText:function(t){if(!t)return!1;if(t=t.trim(),0===t.length)return!1;for(var e=0;e<this.emptyPages.length;e++)if(0==t.indexOf("["+this.emptyPages[e]+"]"))return!1;return!0},getTextStyles:function(t,e){if(!t)return e?[e]:null;var n=/\[(\[?\w+)\]/g,l=n.exec(t);if(l&&l[1]){n.lastIndex=0;for(var a=[];null!==(l=n.exec(t));)l.index===n.lastIndex&&n.lastIndex++,0!=l[1].indexOf("[")?a.push(l[1].toLowerCase()):a.length||a.push(e);return a}return e?[e]:null},getNotes:function(t){if(!t)return null;var e=/\[{2}([^\[]+)\]{2}/g,n=e.exec(t);if(n&&n[1]){e.lastIndex=0;for(var l=[];null!==(n=e.exec(t));)n.index===e.lastIndex&&e.lastIndex++,l.push(n[1]);return l}return null},cleanLine:function(t){if(!t)return null;var e=/(\/{0,2}\ ?)?(\[[\s\w\d]*\]\ ?)*([^\[]*)/,n=e.exec(t);return n&&n[n.length-1]?n[n.length-1].trim():null},replaceText:function(t,e){for(var n=0;n<e.length;n++){var l,a=e[n];if(a.regex){var o="";a.regexG&&(o+="g"),a.regexI&&(o+="i"),l=new RegExp(a.pattern,o)}else l=a.pattern;a.active&&(t=t.replace(l,a.to))}return t},skipThisLine:function(t,e){return!t||(t=this.cleanLine(t),!t||0==t.length||t.charCodeAt(0)==e.charCodeAt(0)&&null)},isMultiBubblePart:function(t){if(!t)return!1;t=t.trim();var e=/^\/{2}.*$/,n=e.test(t);return!!n}},tb=angular.module("tb",["templates","ngSanitize","ui.router","ui.bootstrap","ngStorage","ngToast","angular-clipboard"]);tb.constant("CONF",{appName:"typeset_buddy",debug:!1,version:"0.2.0"}),tb.config(["$compileProvider","$localStorageProvider","ngToastProvider","CONF",function(t,e,n,l){t.debugInfoEnabled(l.debug),e.setKeyPrefix("tb_"),n.configure({verticalPosition:"bottom",maxNumber:10})}]),tb.run(["CONF","$transitions","$state","$stateParams","$rootScope","$trace","themeManager","$localStorage",function(t,e,n,l,a,o,s,i){function c(t){var e;e=t?new CSEvent("com.adobe.PhotoshopPersistent","APPLICATION"):new CSEvent("com.adobe.PhotoshopUnPersistent","APPLICATION"),e.extensionId=a.extensionID,a.CSI.dispatchEvent(e)}a.$state=n,a.$stateParams=l,a.CSI=new CSInterface,a.extensionID=a.CSI.getExtensionID();for(var r=["polyfills","tb_helper"],p=a.CSI.getSystemPath(SystemPath.EXTENSION)+"/jsx/",u=0;u<r.length;u++){var d=p+r[u]+".jsx",g='$.evalFile("'+d+'");';a.CSI.evalScript(g,function(t){})}s.init(),a.os=a.CSI.getOSInformation().toLowerCase().indexOf("mac")>=0?"Mac":"Windows",a.debug=t.debug,a.log=function(t,e){1==a.debug&&(a.logContent||(a.logContent=[]),angular.isDefined(e)?(a.logContent.push({label:t,value:e}),console.log(t,e)):(a.logContent.push({label:"log",value:t}),console.log(t)))};var b=function(t,e){return i.lastOpenedTab=t.to().name,t};e.onFinish(!0,b,{priority:10}),1==a.debug?(o.enable(1),c(!1)):c(!0),a.$watch("debug",function(t,e){t!=e&&(a.debug?(o.enable(1),c(!1)):(o.disable(1),c(!0)))})}]),tb.config(["$stateProvider","$urlRouterProvider","$localStorageProvider",function(t,e,n){n.get("lastOpenedTab")?e.otherwise(n.get("lastOpenedTab")):e.otherwise("/styles"),t.state("app",{url:"/",controller:"AppCtrl",templateUrl:"app.tpl.html"}),t.state("log_view",{url:"/log_view",parent:"app",views:{app:{controller:["$scope",function(t){t.clearLog=function(){t.$root.logContent=[]}}],templateUrl:"log_view.tpl.html"}}})}]),tb.controller("AppCtrl",["$scope","SettingsService","Utils",function(t,e,n){t.resetLocalStorage=function(){n.showConfirmDialog("Are you sure you reset the localstorage? Every style set will be deleted.").then(function(){e.reset()},function(){})},t.routes=[],t.$state.get().forEach(function(e){angular.isDefined(e.nav)&&e.nav===!0&&t.routes.push({name:e.name,label:e.label,order:e.order})}),t.routes.sort(function(t,e){return t.order<e.order?-1:t.order>e.order?1:0})}]),tb.factory("SettingsService",["$rootScope","$localStorage","$q",function(t,e,n){var l=this;return l.init=function(){t.log("$localStorage",e),e.styleSets||(e.styleSets=[tbHelper.getDummyStyleSet("Default set")],e.lastOpenedStyleSet=e.styleSets[0].id),angular.isDefined(e.panelSeparator)||l.setting("panelSeparator","–"),angular.isDefined(e.useLayerGroups)||l.setting("useLayerGroups",!0),angular.isDefined(e.mergeBubbles)||l.setting("mergeBubbles",!1),angular.isDefined(e.lastOpenedScript)||l.setting("lastOpenedScript",""),angular.isDefined(e.textReplace)||l.setting("textReplace",!1),angular.isDefined(e.textReplaceRules)||l.setting("textReplaceRules",tbHelper.getDefaultTextReplaceRules())},l.setting=function(t,n){return angular.isDefined(n)&&(e[t]=n),e[t]},l.reset=function(){e.$reset(),l.init(),location.reload()},l.init(),l}]),tb.factory("themeManager",["$rootScope","Utils",function(t,e){var n=this,l=void 0,a=void 0,o=void 0,s=void 0,i=document.getElementById("theme"),c=document.getElementById("tb");return n.updateThemeWithAppSkinInfo=function(t){l=t.panelBackgroundColor.color,a=e.colorToHex(l),o="F0F0F0",s=l.red>=122,s?(o="000000",i.href="css/topcoat-desktop-light.css",c.classList.remove("dark"),c.classList.add("light")):(i.href="css/topcoat-desktop-dark.css",c.classList.remove("light"),c.classList.add("dark")),c.style.backgroundColor="#"+a,c.style.color="#"+o},n.onAppThemeColorChanged=function(t){var e=JSON.parse(window.__adobe_cep__.getHostEnvironment()).appSkinInfo;n.updateThemeWithAppSkinInfo(e)},n.init=function(){n.updateThemeWithAppSkinInfo(t.CSI.hostEnvironment.appSkinInfo),t.CSI.addEventListener(CSInterface.THEME_COLOR_CHANGED_EVENT,n.onAppThemeColorChanged)},n}]),tb.factory("Utils",["$uibModal",function(t){var e=this;return e.isNumeric=function(t){return t="string"==typeof t?t.replace(",","."):t,!isNaN(parseFloat(t))&&isFinite(t)&&"[object array]"!==Object.prototype.toString.call(t).toLowerCase()},e.endsWith=function(t,e){return t.indexOf(e,t.length-e.length)!==-1},e.uid=function(){var t=(new Date).getTime(),e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var n=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?n:3&n|8).toString(16)});return e},e.isDateString=function(t){var e=Date.parse(t);return isNaN(t)&&!isNaN(e)},e.isNumeric=function(t){return t="string"==typeof t?t.replace(",","."):t,!isNaN(parseFloat(t))&&isFinite(t)&&"[object array]"!==Object.prototype.toString.call(t).toLowerCase()},e.isEmpty=function(t){for(var e in t)return!1;return!0},e.simpleComparison=function(t,e){return JSON.stringify(t)===JSON.stringify(e)},e.browserLocale=function(){return navigator.language?navigator.language:navigator.browserLanguage},e.addTrailingSlash=function(t){return e.endsWith(t,"/")?t:t+"/"},e.removeTrailingSlash=function(t){return e.endsWith(t,"/")?t.substr(0,t.length-1):t},e.extractFileExtension=function(t,e){var n=t.lastIndexOf("."),l=e?0:1;return n>-1?t.substr(n+l).toLowerCase():null},e.extractFilename=function(t){var e=t.lastIndexOf("/");return e>-1?t.substr(e+1):null},e.colorToHex=function(t,e){function n(t,e){var n=isNaN(e)?t:t+e;return n<0?n=0:n>255&&(n=255),n=Math.floor(n),n=n.toString(16),1===n.length?"0"+n:n}var l="";return t&&(l=n(t.red,e)+n(t.green,e)+n(t.blue,e)),l},e.getValidFileSuffix=function(t){var e=new Array;return 0==t.length||-1!=t.indexOf(".*")?e[0]="*":(t=" "+t+" ",t=t.replace(/\*/g," "),t=t.replace(/,/g," "),t=t.replace(/;/g," "),t=t.replace(/\./g," "),e=t.match(/\s\b\w*\b\s/g),e.forEach(function(t,e,n){n[e]=t.replace(/\s/g,"")})),e},e.showConfirmDialog=function(e){var n=t.open({templateUrl:"confirm_dialog.tpl.html",backdrop:"static",backdropClass:"active",size:"xs",resolve:{message:function(){return e}},controller:["$scope","message",function(t,e){t.message=e,t.cancel=function(){t.$dismiss()},t.submit=function(){t.$close()}}]});return n.result},e}]),tb.config(["$stateProvider",function(t){t.state("script_view",{url:"script_view",parent:"app",nav:!0,label:"Script",order:1,views:{app:{controller:"ScriptViewCtrl",templateUrl:"script_view.tpl.html"}}})}]),tb.controller("ScriptViewCtrl",["$scope","SettingsService","ScriptService","StylesService","Utils","ngToast","$timeout","clipboard",function(t,e,n,l,a,o,s,i){t.reset=function(){t.filename="",t.scriptContent="",t.pageContent="",t.pageNumbers=[],t.pageScript="",t.pageNotes="",t.rawBubbles="",t.bubbles=[],t.pageStyle="",t.panelSeparator=e.setting("panelSeparator"),t.useLayerGroups=e.setting("useLayerGroups"),t.mergeBubbles=e.setting("mergeBubbles"),t.textReplace=e.setting("textReplace"),t.styleSet=l.getStyleSet(),t.selectedStyleset=t.styleSet.id},t.browseScript=function(){var e=window.cep.fs.showOpenDialogEx(!1,!1,"Select script file","",a.getValidFileSuffix("*.txt"),void 0,!1);angular.isDefined(e.data[0])&&t.loadScript(e.data[0])},t.loadScript=function(n,l,s){try{var i=window.cep.fs.readFile(n,cep.encoding.UTF8);if(0!==i.err)throw"Could not open translation script";if(e.setting("lastOpenedScript",n),t.filename=a.extractFilename(n),t.scriptContent=i.data,t.pageNumbers=tbHelper.getPageNumbers(t.scriptContent),!(t.pageNumbers.length>0))throw"Did not find any page number in the translation script";s&&null!=l?(t.selectedPage=l,t.loadPage(t.selectedPage)):(o.create({className:"info",content:t.pageNumbers.length+" page(s) found in file"}),t.selectedPage=t.pageNumbers[0])}catch(n){e.setting("lastOpenedScript",null),e.setting("lastOpenedPage",null),t.reset(),o.create({className:"danger",content:n})}},t.reloadScript=function(){e.setting("lastOpenedScript")&&t.loadScript(e.setting("lastOpenedScript"),e.setting("lastOpenedPage"),!0)},t.setting=function(n,l){t[n]=e.setting(n,l)},t.loadPage=function(n){if(angular.isDefined(n)&&null!=n&&!a.isEmpty(t.scriptContent))if(t.pageScript=tbHelper.loadPage(t.scriptContent,n),null!=t.pageScript){var l=tbHelper.getTextStyles(t.pageScript[1],"default_style")[0];if(t.pageStyle=t.styleSet.styles.findIndex(function(t){return t.keyword==l})===-1?{keyword:l,inStyleSet:!1}:{keyword:l,inStyleSet:!0},t.$root.log("pageStyle",t.pageStyle),t.pageNotes=tbHelper.getNotes(t.pageScript[1]),t.$root.log("pageNotes",t.pageNotes),t.rawBubbles=t.pageScript[2],t.bubbles=[],t.$root.log("rawBubbles",t.rawBubbles),tbHelper.pageContainsText(t.rawBubbles)){t.$root.log("contains text");var s=[],i=t.pageStyle.keyword;s=t.rawBubbles.split("\n"),t.$root.log("lines",s),s.forEach(function(n){var l=tbHelper.getNotes(n),o=tbHelper.skipThisLine(n,t.panelSeparator);if(o===!1||l){var s={text:tbHelper.cleanLine(n),styles:[],multibubblePart:!1,notes:l},c=[];if(s.text&&(t.textReplace&&(s.text=tbHelper.replaceText(s.text,e.setting("textReplaceRules"))),tbHelper.isMultiBubblePart(n)?(c=tbHelper.getTextStyles(n,i),s.multibubblePart=!0):c=tbHelper.getTextStyles(n,t.pageStyle.keyword),i=c[0],s.styles=c.map(function(e){var n=t.styleSet.styles.findIndex(function(t){return t.keyword==e});return n===-1?{keyword:e,inStyleSet:!1}:{keyword:e,inStyleSet:!0}})),t.mergeBubbles&&1==s.multibubblePart){var r=t.bubbles[t.bubbles.length-1];r.merged=!0,r.siblings||(r.siblings=[]),r.siblings.push(s),r.styles=r.styles.concat(s.styles.filter(function(t){return!r.styles.find(function(e){return!!a.simpleComparison(e,t)})}))}else t.bubbles.push(s)}else null===o&&t.bubbles.push({panelSeparator:!0})})}e.setting("lastOpenedPage",n),t.$root.log("bubbles",t.bubbles)}else o.create({className:"info",content:"Could not find page "+n+" in file"}),t.selectedPage=null,e.setting("lastOpenedPage",null),t.bubbles=[];else t.bubbles=[]},t.incPageNumber=function(n){var l=n?1:-1;if(t.pageNumbers.length)if(angular.isDefined(t.selectedPage)){var a=t.pageNumbers.findIndex(function(e){return e==t.selectedPage});angular.isDefined(t.pageNumbers[a+l])&&(t.selectedPage=t.pageNumbers[a+l],e.setting("lastOpenedPage",t.selectedPage))}else t.selectedPage=t.pageNumbers[0]},t.typeset=function(e,l){if(t.selectedForcedStyle&&(t.$root.log("force style",t.selectedForcedStyle),l={keyword:t.selectedForcedStyle,inStyleSet:!0}),l.inStyleSet){var a=t.styleSet.styles.find(function(t){return t.keyword==l.keyword});a||(a=t.styleSet.styles[0]);var s=e.text;e.siblings&&e.siblings.forEach(function(t){s+="\r"+t.text});var i={text:s,style:a};n.maybeTypesetToPath(i).then(function(){},function(t){o.create({className:"danger",content:t})})}else o.create({className:"danger",content:'Style "'+l.keyword+'" not found in styleset'})},t.toClipboard=function(t){i.copyText(t)},t.reset(),t.loadStyleSet=function(){t.styleSet=l.getStyleSet(t.selectedStyleset)},s(function(){e.setting("lastOpenedScript")&&t.loadScript(e.setting("lastOpenedScript"),e.setting("lastOpenedPage"),!0)},300),t.$watch("selectedPage",function(e,n){angular.isDefined(e)&&t.loadPage(e)}),t.$watchGroup(["panelSeparator","mergeBubbles","textReplace"],function(e,n){angular.isDefined(e)&&t.loadPage(t.selectedPage)}),t.$watch("selectedStyleset",function(e,n){angular.isDefined(e)&&null!=e&&(t.loadStyleSet(e),t.loadPage(t.selectedPage))})}]),tb.factory("ScriptService",["$rootScope","SettingsService","$q",function(t,e,n){var l=this;return l.maybeTypesetToPath=function(a){var o=n.defer(),s=angular.copy(a);return s.useLayerGroups=e.setting("useLayerGroups"),t.log("typesetObj",s),t.CSI.evalScript('tryExec("getSingleRectangleSelectionDimensions");',function(e){if(t.log("maybeTypesetToPath return",e),"no_document"==e)o.reject("No document");else{if("no_selection"==e)return l.typeset(s);if("multiple_paths"==e)o.reject("Too many paths. Only one path allowed.");else if("too_many_anchors"==e)o.reject("Too many anchors in path. Only rectangle paths are allowed (use the marquee tool).");else try{if(e=JSON.parse(e),angular.isDefined(e.p))return s.style.dimensions=e,l.typeset(s);o.reject("The dimensions were malformed.")}catch(t){o.reject("Could not parse the dimensions.")}}}),o.promise},l.typeset=function(e){var l=n.defer();return t.$root.CSI.evalScript('tryExec("typesetEX", '+JSON.stringify(e)+");",function(e){t.log("typeset return",e),"no_document"===e?l.reject("No document"):"done"===e?l.resolve():l.reject(e)}),l.promise},l}]),tb.config(["$stateProvider",function(t){t.state("styles",{url:"styles",parent:"app",nav:!0,label:"Styles",order:0,views:{app:{controller:"StylesCtrl",templateUrl:"styles.tpl.html"}}})}]),tb.controller("StylesCtrl",["$scope","StylesService","ScriptService","ngToast","Utils","$uibModal",function(t,e,n,l,a,o){t.clearStyleFilter=function(){t.styleFilter=void 0},t.newStyleSet=function(){t.styleSet=tbHelper.getDummyStyleSet(),t.selectedStyleset=null},t.saveStyleSet=function(){try{e.saveStyleSet(t.styleSet),t.loadCurrentStyleSet(),l.create({className:"success",content:"Saved"})}catch(t){l.create({className:"danger",content:t})}},t.exportStyleSet=function(){if(angular.isDefined(t.selectedStyleset)){var n=e.getStyleSet(t.selectedStyleset);delete n.id;var o=window.cep.fs.showSaveDialogEx("Export styleset",void 0,a.getValidFileSuffix("*.json"),n.name+"_styleset.json",void 0,"Export style set",void 0);if(o.data){var s=window.cep.fs.writeFile(o.data,JSON.stringify(n,null,2),cep.encoding.UTF8);0!=s.err&&l.create({className:"danger",content:"Failed to write a file at the destination:"+o.data+", error code:"+s.err})}}},t.maybeAddStyleToSet=function(e){var n=t.styleSet.styles.findIndex(function(t){return t.keyword==e});n==-1&&t.styleSet.styles.push(tbHelper.getDummyStyle(e))},t.extendStyleSet=function(){var e=window.cep.fs.showOpenDialogEx(!1,!1,"Select script file","",a.getValidFileSuffix("*.txt"),void 0,!1);if(angular.isDefined(e.data[0])){var o=window.cep.fs.readFile(e.data[0]);if(0===o.err){var s=o.data,i=n.getPageNumbers(s),c=[];i.length>0?(i.forEach(function(t){var e=n.loadPage(s,t);if(null!=e){var l=[];if(l.push(n.getTextStyles(e[1],"default_style")[0]),n.pageContainsText(e[2])){var a=e[2].split("\n");a.forEach(function(t){var e=n.getTextStyles(t,"default_style");l=l.concat(e.filter(function(t){return l.indexOf(t)<0}))})}c=c.concat(l.filter(function(t){return c.indexOf(t)<0}))}}),c.forEach(function(e){t.maybeAddStyleToSet(e)}),l.create({className:"success",content:"Done"})):l.create({className:"info",content:"Did not find any page number in the script"})}else l.create({className:"danger",content:"Could not read the file"})}},t.importStyleSet=function(){var n=window.cep.fs.showOpenDialogEx(!1,!1,"Select styleset file","",a.getValidFileSuffix("*.json"),void 0,!1);if(angular.isDefined(n.data[0])){t.selectedStyleset=null;var o=window.cep.fs.readFile(n.data[0]);if(0===o.err)try{var s=JSON.parse(o.data);t.log("parsed",s),e.cleanAndCheckStyleSet(s),delete s.id,t.styleSet=angular.copy(s)}catch(e){t.styleSet=tbHelper.getDummyStyleSet(),l.create({className:"danger",content:"Import error: "+e})}else t.styleSet=tbHelper.getDummyStyleSet(),l.create({className:"danger",content:"Could not read the file"})}},t.exportStyleProps=function(){var t=window.cep.fs.showSaveDialogEx("Export fonts and style properties",void 0,a.getValidFileSuffix("*.json"),"tb_fonts_and_styleprops.json",void 0,"Export",void 0);t.data&&e.getAppFonts().then(function(e){var n={styleProperties:angular.copy(tbHelper.styleProps),fonts:e},a=window.cep.fs.writeFile(t.data,JSON.stringify(n,null,2));0!=a.err&&l.create({className:"danger",content:"Failed to write a file at the destination:"+t.data+", error code:"+a.err})})},t.addStyle=function(){t.styleSet.styles.push(tbHelper.getDummyStyle())},t.deleteStyleSet=function(){angular.isDefined(t.styleSet.id)&&a.showConfirmDialog('Are you sure you want to delete the style set "'+t.styleSet.name+'" ?').then(function(){e.deleteStyleSet(t.styleSet.id)===!0&&(l.create({className:"success",content:"Deleted"}),t.selectedStyleset=0)},function(){})},t.duplicateStyle=function(e){var n=angular.copy(e);n.keyword="Copy of "+n.keyword,delete n.default;var l=t.styleSet.styles.indexOf(e);l>-1?t.styleSet.styles.splice(l+1,0,n):t.styleSet.styles.push(n)},t.duplicateStyleSet=function(){if(angular.isDefined(t.selectedStyleset)){var n=e.getStyleSet(t.selectedStyleset);delete n.id,n.name="Copy of "+n.name,t.styleSet=n,t.selectedStyleset=null}},t.removeStyle=function(e){a.showConfirmDialog("Remove style ?").then(function(){var n=t.styleSet.styles.indexOf(e);n>-1&&t.styleSet.styles.splice(n,1)},function(){})},t.applyStyleSelectedLayers=function(t,n){var a=angular.copy(t);a.noResize=!n,e.actionSelectedLayers("applyStyle",a).then(function(){l.create({className:"success",content:"Done"})},function(t){l.create({className:"danger",content:t})})},t.setStyle=function(t){var n=angular.copy(t);e.setStyle(n).then(function(){},function(t){l.create({className:"danger",content:t})})},t.actionSelectedLayers=function(t,n){e.actionSelectedLayers(t,n).then(function(){l.create({className:"success",content:"Done"})},function(t){l.create({className:"danger",content:t})})},t.loadStyleSet=function(){t.styleSet=e.getStyleSet(t.selectedStyleset)},t.loadCurrentStyleSet=function(){t.styleSet=e.getStyleSet(),t.selectedStyleset=t.styleSet.id},t.loadCurrentStyleSet(),t.$watch("selectedStyleset",function(e,n){angular.isDefined(e)&&null!=e&&t.loadStyleSet(e)})}]),tb.directive("antialiasSelector",["StylesService",function(t){return{restrict:"E",scope:{selectedValue:"="},replace:!0,template:'<select ng-options="choice.value as choice.label for choice in choices" ng-model="selectedValue"></select>',link:function(t,e,n){t.choices=tbHelper.styleProps.antialias.values,t.selectedValue||(t.selectedValue=tbHelper.styleProps.antialias.def)}}}]),tb.directive("capitalizationSelector",["StylesService",function(t){return{restrict:"E",scope:{selectedValue:"="},replace:!0,template:'<select ng-options="choice.value as choice.label for choice in choices" ng-model="selectedValue"></select>',link:function(t,e,n){t.choices=tbHelper.styleProps.capitalization.values,t.selectedValue||(t.selectedValue=tbHelper.styleProps.capitalization.def)}}}]),tb.directive("fontSelector",["StylesService",function(t){return{restrict:"E",scope:{selectedValue:"="},replace:!0,template:'<select ng-options="choice.value as choice.label for choice in choices | orderBy: \'label\'" ng-model="selectedValue"></select>',link:function(e,n,l){t.getAppFonts().then(function(t){e.choices=t,e.selectedValue||(e.selectedValue=tbHelper.styleProps.fontName.def)})}}}]),tb.directive("justificationSelector",["StylesService",function(t){return{restrict:"E",scope:{selectedValue:"="},replace:!0,template:'<select ng-options="choice.value as choice.label for choice in choices" ng-model="selectedValue"></select>',link:function(t,e,n){t.choices=tbHelper.styleProps.justification.values,t.selectedValue||(t.selectedValue=tbHelper.styleProps.justification.def)}}}]),tb.directive("kerningSelector",["StylesService",function(t){return{restrict:"E",scope:{selectedValue:"="},replace:!0,template:'<select ng-options="choice.value as choice.label for choice in choices" ng-model="selectedValue"></select>',link:function(t,e,n){t.choices=tbHelper.styleProps.kerning.values,t.selectedValue||(t.selectedValue=tbHelper.styleProps.kerning.def)}}}]),tb.directive("tbStylePreset",[function(){return{restrict:"E",scope:{preset:"=",removeAction:"&",duplicateAction:"&",applyAction:"&",setAction:"&"},templateUrl:"style_preset.tpl.html",controller:["$scope","StylesService",function(t,e){}]}}]),tb.directive("tbStyleSelector",["StylesService",function(t){return{restrict:"E",scope:{styleset:"=",selectedValue:"="},replace:!0,template:'<select ng-options="choice as choice for choice in choices" ng-model="selectedValue"><option value="">-</option></select>',link:function(e,n,l){e.refreshStyleList=function(){e.choices=[];var n=t.getStyleSet(e.styleset);n.styles.forEach(function(t){e.choices.push(t.keyword)}),e.selectedValue||(e.selectedValue=null)},e.$watch("styleset",function(t,n){angular.isDefined(t)?e.refreshStyleList():e.choices=[]})}}}]),tb.directive("stylesetSelector",["StylesService",function(t){return{restrict:"E",scope:{selectedValue:"="},replace:!0,template:'<select ng-options="choice.id as choice.name for choice in choices | orderBy: \'name\'" ng-model="selectedValue"></select>',link:function(e,n,l){e.choices=[],e.refreshStylesetList=function(){e.choices=t.getStyleSetList(),e.selectedValue||(e.selectedValue=e.choices[0].id)},e.$on("refresh-styleset-list",e.refreshStylesetList),e.refreshStylesetList()}}}]),tb.factory("StylesService",["$rootScope","$localStorage","$q","Utils","ngToast",function(t,e,n,l,a){var o=this;return o.appFonts=[],o.getAppFonts=function(){var e=n.defer();return o.appFonts.length?e.resolve(angular.copy(o.appFonts)):t.CSI.evalScript("getAppFonts();",function(t){o.appFonts=JSON.parse(t),e.resolve(angular.copy(o.appFonts))}),e.promise},o.getStyleSetList=function(){return e.styleSets},o.cleanAndCheckStyleSet=function(t){tbHelper.checkStyleSet(t);var n=angular.isDefined(t.id)?e.styleSets.findIndex(function(e){return e.id==t.id}):-1,l=-1;n>-1&&(l=e.styleSets[n].id);for(var a=0;a<e.styleSets.length;a++)if(e.styleSets[a].name.trim().toLowerCase()==t.name.trim().toLowerCase()&&e.styleSets[a].id!=l)throw"A styleset with the same name already exists"},o.saveStyleSet=function(n){o.cleanAndCheckStyleSet(n),angular.isDefined(n.id)||(n.id=tbHelper.uniqueId());var l=e.styleSets.findIndex(function(t){return t.id==n.id});l>-1?e.styleSets[l]=angular.copy(n):e.styleSets.push(angular.copy(n)),e.lastOpenedStyleSet=n.id,t.$broadcast("refresh-styleset-list")},o.getStyleSet=function(t){var n=void 0;if(angular.isDefined(t)){var l=e.styleSets.findIndex(function(e){return e.id==t});l>-1&&(n=angular.copy(e.styleSets[l]))}else angular.isDefined(e.lastOpenedStyleSet)&&(n=o.getStyleSet(e.lastOpenedStyleSet));return n?(e.lastOpenedStyleSet=n.id,n):tbHelper.getDummyStyleSet()},o.deleteStyleSet=function(n){var l=e.styleSets.findIndex(function(t){return t.id==n});return"Default set"==e.styleSets[l].name?(a.create({className:"danger",content:"Cannot delete default style set"}),!1):l>-1?(e.styleSets.splice(l,1),delete e.lastOpenedStyleSet,t.$broadcast("refresh-styleset-list"),!0):void 0},o.setStyle=function(e){var l=n.defer();return t.$root.CSI.evalScript('tryExec("setStyle", '+JSON.stringify(e)+");",function(e){t.log("setStyle return",e),"no_document"===e?l.reject("No document."):"done"===e?l.resolve():l.reject(e)}),l.promise},o.actionSelectedLayers=function(e,l){var a=n.defer(),o='"'+e+'SelectedLayers"';return angular.isDefined(l)&&(o+=", "+JSON.stringify(l)),t.$root.CSI.evalScript("tryExec("+o+");",function(e){t.log(o+" return",e),"no_document"===e?a.reject("No document."):"no_selected_layers"===e?a.reject("Could not retrieve the selected layers."):"not_text_layer"===e?a.reject("Not a text layer."):"done"===e?a.resolve():a.reject(e)}),a.promise},o}]),tb.config(["$stateProvider",function(t){t.state("text_replacer",{url:"text_replacer",parent:"app",nav:!0,label:"Text Replace",order:3,views:{app:{controller:"TextReplacerCtrl",templateUrl:"text_replacer.tpl.html"}}})}]),tb.controller("TextReplacerCtrl",["$scope","SettingsService","Utils","ngToast","$timeout","clipboard",function(t,e,n,l,a,o){t.textReplaceRules=e.setting("textReplaceRules"),t.moveRule=function(e,n){var l=n?-1:1,a=t.textReplaceRules.findIndex(function(t){return t.id==e.id});angular.isDefined(t.textReplaceRules[a+l])&&(t.textReplaceRules.splice(a,1),t.textReplaceRules.splice(a+l,0,e))},t.addRule=function(){t.textReplaceRules.push(angular.copy(tbHelper.getDummyTextReplaceRule()))},t.removeRule=function(e){var n=t.textReplaceRules.findIndex(function(t){return t.id==e.id});t.textReplaceRules.splice(n,1)},t.exportRules=function(){var e=window.cep.fs.showSaveDialogEx("Export text replace rules",void 0,n.getValidFileSuffix("*.json"),"text_replace_rules.json",void 0,"Export text replace rules",void 0);if(e.data){var a=angular.copy(t.textReplaceRules);a.forEach(function(t){delete t.id});var o={textReplaceRules:a},s=window.cep.fs.writeFile(e.data,JSON.stringify(o,null,2),cep.encoding.UTF8);0!=s.err&&l.create({className:"danger",content:"Failed to write a file at the destination:"+e.data+", error code:"+s.err})}},t.importRules=function(){var e=window.cep.fs.showOpenDialogEx(!1,!1,"Select rules file","",n.getValidFileSuffix("*.json"),void 0,!1);if(angular.isDefined(e.data[0])){var a=window.cep.fs.readFile(e.data[0]);if(0===a.err)try{var o=JSON.parse(a.data);t.log("parsed",o);var s=void 0;if(angular.isDefined(o.textReplaceRules)?s=o.textReplaceRules:Array.isArray(o)&&(s=o),!angular.isDefined(o))throw"The file does not seem to contain any rule";t.textReplaceRules=t.textReplaceRules.concat(tbHelper.cleanTextReplaceRules(s))}catch(t){l.create({className:"danger",content:"Import error: "+t})}else l.create({className:"danger",content:"Could not read the file"})}},t.appendDefaults=function(){t.textReplaceRules=t.textReplaceRules.concat(tbHelper.getDefaultTextReplaceRules())},t.$watch("textReplaceRules",function(n,l){e.setting("textReplaceRules",t.textReplaceRules)},!0)}]),angular.module("templates",[]).run(["$templateCache",function(t){t.put("app.tpl.html",'<uib-tabset active="null" class="">\n\t<uib-tab index="one.name" heading="{{one.label}}" ui-sref="{{one.name}}" ui-sref-active="active" ng-repeat="one in routes"></uib-tab>\n\t<uib-tab index="9" heading="Log" ui-sref="log_view" ui-sref-active="active" ng-if="$root.debug"></uib-tab>\n\t<uib-tab index="10" heading="RESET" ng-click="resetLocalStorage()" ng-if="$root.debug"></uib-tab>\n\n\n</uib-tabset>\n\n<ui-view name="app" class="flex-col"></ui-view>\n'),
t.put("confirm_dialog.tpl.html",'<div class="modal-header">\n\t<h3 class="modal-title" id="modal-title">Confirm</h3>\n</div>\n<div class="modal-body" id="modal-body">\n\t{{message}}\n</div>\n<div class="modal-footer">\n\t<button class="btn btn-primary" type="button" ng-click="submit()">OK</button>\n\t<button class="btn btn-warning" type="button" ng-click="cancel()">Cancel</button>\n</div>\n'),t.put("log_view.tpl.html",'<div class="no-shrink p header">\n\t<button class="topcoat-button" ng-click="clearLog()">\n\t\t<span class="glyphicon glyphicon-trash"></span>\n\t\tClear log\n\t</button>\n</div>\n<div class="list scrollable">\n\t<div class="no-shrink row pb" ng-repeat="entry in $root.logContent">\n\t\t<div class="col-md-2 col-xs-2">\n\t\t\t<label>{{entry.label}}</label>\n\t\t</div>\n\t\t<div class="col-md-10 col-xs-10">\n\t\t\t<pre>{{entry.value|json}}</pre>\n\t\t</div>\n\t</div>\n</div>\n'),t.put("script_view.tpl.html",'<div class="row no-shrink">\n\t<div class="col-md-5 col-xs-5 flex-input">\n\t\t<div class="input-wrapper">\n\t\t\t<label class="">\n\t\t\t\t<span>Script</span>\n\t\t\t</label>\n\t\t\t<input type="text" class="topcoat-text-input" readonly="true" ng-model="filename" ng-click="browseScript()" uib-tooltip="{{filename}}" tooltip-popup-delay="500" tooltip-placement="bottom">\n\t\t</div>\n\t</div>\n\t<div class="col-md-1 col-xs-1 flex-input">\n\t\t<button class="topcoat-button" ng-click="reloadScript()" ng-if="!!filename" uib-tooltip="Reload script" tooltip-popup-delay="1000" tooltip-placement="bottom">\n\t\t\t<span class="glyphicon glyphicon-repeat"></span>\n\t\t</button>\n\t</div>\n\t<div class="col-md-5 col-xs-5 flex-input">\n\t\t<div class="input-wrapper">\n\t\t\t<label class="">\n\t\t\t\t<span>Style Set</span>\n\t\t\t</label>\n\t\t\t<styleset-selector selected-value="selectedStyleset"></styleset-selector>\n\t\t</div>\n\t</div>\n\n\t<div class="col-md-1 col-xs-1 flex-input">\n\t\t<div class="btn-group" uib-dropdown is-open="status.isopen">\n\t\t\t<button class="topcoat-button" uib-dropdown-toggle>\n\t\t\t\t<span class="glyphicon glyphicon-cog"></span>\n\t\t\t</button>\n\t\t\t<ul class="dropdown-menu dropdown-menu-right" uib-dropdown-menu role="menu" aria-labelledby="single-button">\n\t\t\t\t<li class="dropdown-header">Panel separator</li>\n\t\t\t\t<li role="menu-item" ng-class="{\'active\': panelSeparator == \'–\'}" ng-click="setting(\'panelSeparator\', \'–\')"><span>Long dash –</span></li>\n\t\t\t\t<li role="menu-item" ng-class="{\'active\': panelSeparator == \'-\'}" ng-click="setting(\'panelSeparator\', \'-\')"><span>Single dash -</span></li>\n\t\t\t\t<li role="menu-item" ng-class="{\'active\': panelSeparator == \'--\'}" ng-click="setting(\'panelSeparator\', \'--\')"><span>Double dash --</span></li>\n\t\t\t\t<li role="menu-item" ng-class="{\'active\': panelSeparator == \'=\'}" ng-click="setting(\'panelSeparator\', \'=\')"><span>Equal sign =</span></li>\n\t\t\t\t<li class="divider"></li>\n\t\t\t\t<li role="menu-item" class="dropdown-header">Use layer groups</li>\n\t\t\t\t<li role="menu-item" ng-class="{\'active\': useLayerGroups === true}" ng-click="setting(\'useLayerGroups\', true)"><span>Yes</span></li>\n\t\t\t\t<li role="menu-item" ng-class="{\'active\': useLayerGroups === false}" ng-click="setting(\'useLayerGroups\', false)" ><span>No</span></li>\n\t\t\t\t<li class="divider"></li>\n\t\t\t\t<li role="menu-item" class="dropdown-header">Merge multibubbles</li>\n\t\t\t\t<li role="menu-item" ng-class="{\'active\': mergeBubbles === true}" ng-click="setting(\'mergeBubbles\', true)"><span>Yes</span></li>\n\t\t\t\t<li role="menu-item" ng-class="{\'active\': mergeBubbles === false}" ng-click="setting(\'mergeBubbles\', false)" ><span>No</span></li>\n\t\t\t\t<li class="divider"></li>\n\t\t\t\t<li role="menu-item" class="dropdown-header">Text replacement</li>\n\t\t\t\t<li role="menu-item" ng-class="{\'active\': textReplace === true}" ng-click="setting(\'textReplace\', true)"><span>Enabled</span></li>\n\t\t\t\t<li role="menu-item" ng-class="{\'active\': textReplace === false}" ng-click="setting(\'textReplace\', false)" ><span>Disabled</span></li>\n\t\t\t</ul>\n\t\t</div>\n\t</div>\n</div>\n<div class="no-shrink row pb header">\n\t<div class="col-lg-4 col-md-4 col-xs-4">\n\t\t<label>Page</label>\n\t\t<button class="topcoat-icon-button--quiet" ng-disabled="!!!pageNumbers.length">\n\t\t\t<span class="glyphicon glyphicon-minus" ng-click="incPageNumber(false)"></span>\n\t\t</button>\n\n\t\t\t<select ng-options="pageNumber as pageNumber for pageNumber in pageNumbers" ng-model="selectedPage" ng-disabled="!!!pageNumbers.length">\n\n\t\t\t</select>\n\n\t\t<button class="topcoat-icon-button--quiet" ng-disabled="!!!pageNumbers.length">\n\t\t\t<span class="glyphicon glyphicon-plus" ng-click="incPageNumber(true)"></span>\n\t\t</button>\n\t</div>\n\t<div class="col-lg-4 col-md-4 col-xs-4">\n\t\t<label ng-if="!!selectedPage && !!bubbles.length">\n\t\t\tPage style: {{pageStyle.keyword}} <span class="glyphicon glyphicon-warning-sign" ng-if="!!!pageStyle.inStyleSet"></span>\n\t\t</label>\n\t</div>\n\t<div class="col-lg-4 col-md-4 col-xs-4">\n\t\t<label>\n\t\t\tForce\n\t\t</label>\n\t\t<tb-style-selector styleset="selectedStyleset" selected-value="selectedForcedStyle"></tb-style-selector>\n\t</div>\n\n</div>\n<div class="page-note" ng-repeat="pageNote in pageNotes">\n\t{{pageNote}}\n</div>\n<div class="list scrollable">\n\t<div class="list-item p" ng-if="!!selectedPage && !!!bubbles.length">Nothing to typeset on this page</div>\n\t<div class="list-item row bubble-item" ng-class="{\'multibubble-part\': !!bubble.multibubblePart, \'panel-separator\': !!bubble.panelSeparator}" ng-repeat="bubble in bubbles">\n\t\t<div class="col-lg-2 col-md-3 col-xs-3 style-buttons" ng-if="!!!bubble.panelSeparator">\n\t\t\t<button class="topcoat-button" ng-repeat="style in bubble.styles track by $index" ng-click="typeset(bubble, style)" uib-tooltip="Create it first or use the force :D" tooltip-popup-delay="1000" tooltip-placement="bottom-left" tooltip-enable="!!!style.inStyleSet">\n\t\t\t\t<span>{{style.keyword}}</span>\n\t\t\t\t<span class="glyphicon glyphicon-warning-sign" ng-if="!!!style.inStyleSet"></span>\n\t\t\t</button>\n\t\t</div>\n\t\t<div class="col-lg-10 col-md-9 col-xs-9" ng-if="!!!bubble.panelSeparator">\n\t\t\t<div class="selectable bubble-content" ng-if="!!bubble.text">{{bubble.text}}<button class="topcoat-button clipbutton">\n\t\t\t\t\t<span class="glyphicon glyphicon-copy" ng-click="toClipboard(bubble.text)"></span>\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t\t<div class="bubble-note selectable" ng-repeat="note in bubble.notes">\n\t\t\t\t{{note}}\n\t\t\t\t<button class="topcoat-button clipbutton">\n\t\t\t\t\t<span class="glyphicon glyphicon-copy" ng-click="toClipboard(bubble.notes)"></span>\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t\t<div class="bubble-sibling" ng-repeat="sibling in bubble.siblings">\n\t\t\t\t<div class="selectable bubble-content">{{sibling.text}}<button class="topcoat-button clipbutton">\n\t\t\t\t\t\t<span class="glyphicon glyphicon-copy" ng-click="toClipboard(sibling.text)"></span>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t\t<div class="bubble-note selectable" ng-repeat="note in sibling.notes">\n\t\t\t\t\t{{note}}\n\t\t\t\t\t<button class="topcoat-button clipbutton">\n\t\t\t\t\t\t<span class="glyphicon glyphicon-copy" ng-click="toClipboard(note)"></span>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n'),t.put("style_preset.tpl.html",'<div class="row m0">\n\t<div class="col-md-4 col-xs-4">\n\t\t<label class="input-flex">\n\t\t\t<span>Keyword</span>\n\t\t\t<input type="text" class="topcoat-text-input" placeholder="Keyword" ng-model="preset.keyword" ng-disabled="preset.default" ng-pattern="/^[\\d\\w_]+$/i">\n\t\t</label>\n\t</div>\n\t<div class="col-md-6 col-xs-6">\n\t\t<label class="input-flex input-flex-larger">\n\t\t\t<span>Font</span>\n\t\t\t<font-selector selected-value="preset.fontName"></font-selector>\n\t\t</label>\n\t</div>\n\t<div class="col-md-2 col-xs-2 text-right">\n\t\t<button class="topcoat-button" ng-click="duplicateAction()" uib-tooltip="Duplicate style" tooltip-popup-delay="500" tooltip-placement="bottom-right">\n\t\t\t<span class="glyphicon glyphicon-duplicate"></span>\n\t\t</button>\n\t\t<button class="topcoat-button" ng-click="removeAction()" ng-if="preset.keyword != \'default_style\'" uib-tooltip="Remove style" tooltip-popup-delay="500" tooltip-placement="bottom-right">\n\t\t\t<span class="glyphicon glyphicon-trash"></span>\n\t\t</button>\n\t</div>\n</div>\n\n<div class="row m0">\n\t<div class="col-md-4 col-xs-4">\n\t\t<div>\n\t\t\t<label class="input-flex">\n\t\t\t\t<span>Size (px)</span>\n\t\t\t\t<input type="number" class="topcoat-text-input" min="1" max="1000" step="1" ng-model="preset.size" placeholder="1 to 1000 px" uib-tooltip="min:1 max:1000 default:20" tooltip-popup-delay="500" tooltip-placement="bottom-right">\n\t\t\t</label>\n\t\t</div>\n\t\t<div>\n\t\t\t<label class="input-flex">\n\t\t\t\t<span>VScale (%)</span>\n\t\t\t\t<input type="number" class="topcoat-text-input" min="1" max="1000" step="1" ng-model="preset.vScale" placeholder="1 to 1000 %" uib-tooltip="min:1 max:1000 default:100" tooltip-popup-delay="500" tooltip-placement="bottom-right">\n\t\t\t</label>\n\t\t</div>\n\t\t<div>\n\t\t\t<label class="input-flex">\n\t\t\t\t<span>HScale (%)</span>\n\t\t\t\t<input type="number" class="topcoat-text-input" min="1" max="1000" step="1" ng-model="preset.hScale" placeholder="1 to 1000 %" uib-tooltip="min:1 max:1000 default:100" tooltip-popup-delay="500" tooltip-placement="bottom-right">\n\t\t\t</label>\n\t\t</div>\n\t\t<div class="input-flex">\n\t\t\t<label>\n\t\t\t\t<span>Hyphenate</span>\n\t\t\t</label>\n\t\t\t<div>\n\t\t\t\t<label class="topcoat-switch">\n\t\t\t\t\t<input type="checkbox" ng-model="preset.hyphenate" ng-true-value="true" class="topcoat-switch__input">\n\t\t\t\t\t<div class="topcoat-switch__toggle"></div>\n\t\t\t\t</label>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\n\t<div class="col-md-4 col-xs-4">\n\t\t<div>\n\t\t\t<label class="input-flex">\n\t\t\t\t<span>Leading (px)</span>\n\t\t\t\t<input type="number" class="topcoat-text-input" min="0" max="1000" step="1" ng-model="preset.leading" placeholder="0 to 1000" uib-tooltip="min:0 max:1000 default:0 (auto)" tooltip-popup-delay="500" tooltip-placement="bottom-right">\n\t\t\t</label>\n\t\t</div>\n\t\t<div>\n\t\t\t<label class="input-flex">\n\t\t\t\t<span>Tracking</span>\n\t\t\t\t<input type="number" class="topcoat-text-input" min="-1000" max="10000" step="1" ng-model="preset.tracking" placeholder="-1000 to 10000" uib-tooltip="min:-1000 max:10000 default:0" tooltip-popup-delay="500" tooltip-placement="bottom-right">\n\t\t\t</label>\n\t\t</div>\n\t\t<div class="input-flex">\n\t\t\t<label>\n\t\t\t\t<span>FauxBold</span>\n\t\t\t</label>\n\t\t\t<div>\n\t\t\t\t<label class="topcoat-switch">\n\t\t\t\t\t<input type="checkbox" ng-model="preset.fauxBold" ng-true-value="true" class="topcoat-switch__input">\n\t\t\t\t\t<div class="topcoat-switch__toggle"></div>\n\t\t\t\t</label>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="input-flex">\n\t\t\t<label>\n\t\t\t\t<span>FauxItalic</span>\n\t\t\t</label>\n\t\t\t<div>\n\t\t\t\t<label class="topcoat-switch">\n\t\t\t\t\t<input type="checkbox" ng-model="preset.fauxItalic" ng-true-value="true" class="topcoat-switch__input">\n\t\t\t\t\t<div class="topcoat-switch__toggle"></div>\n\t\t\t\t</label>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\n\t<div class="col-md-4 col-xs-4">\n\t\t<div>\n\t\t\t<label class="input-flex">\n\t\t\t\t<span>Antialias</span>\n\t\t\t\t<antialias-selector selected-value="preset.antialias"></antialias-selector>\n\t\t\t</label>\n\t\t</div>\n\t\t<div>\n\t\t\t<label class="input-flex">\n\t\t\t\t<span>Capitalization</span>\n\t\t\t\t<capitalization-selector selected-value="preset.capitalization"></capitalization-selector>\n\t\t\t</label>\n\t\t</div>\n\t\t<div>\n\t\t\t<label class="input-flex">\n\t\t\t\t<span>Justification</span>\n\t\t\t\t<justification-selector selected-value="preset.justification"></justification-selector>\n\t\t\t</label>\n\t\t</div>\n\t\t<div>\n\t\t\t<label class="input-flex">\n\t\t\t\t<span>Kerning</span>\n\t\t\t\t<kerning-selector selected-value="preset.kerning"></kerning-selector>\n\t\t\t</label>\n\t\t</div>\n\t</div>\n</div>\n<div class="row m0">\n\t<div class="col-md-4 col-xs-4">\n\t\t<label class="input-flex">\n\t\t\t<span>Layer group</span>\n\t\t\t<input type="text" class="topcoat-text-input" placeholder="Layer group" ng-model="preset.layerGroup" >\n\t\t</label>\n\t</div>\n\t<div class="col-md-8 col-xs-8 text-right">\n\t\t<button class="topcoat-button" ng-click="setAction()" uib-tooltip="Just set the style parameters" tooltip-popup-delay="500" tooltip-placement="bottom-right">\n\t\t\t<span class="glyphicon glyphicon-text-color"></span>\n\t\t</button>\n\t\t<button class="topcoat-button" ng-click="applyAction()" uib-tooltip="Apply style on selected text layers" tooltip-popup-delay="500" tooltip-placement="bottom-right">\n\t\t\t<span class="glyphicon glyphicon-tint"></span>\n\t\t</button>\n\t\t<button class="topcoat-button" ng-click="applyAction({style:preset, resize:true})" uib-tooltip="Apply style on selected text layers and auto-resize them" tooltip-popup-delay="500" tooltip-placement="bottom-right">\n\t\t\t<span class="glyphicon glyphicon-tint"></span>+<span class="glyphicon glyphicon-resize-small"></span>\n\t\t</button>\n\t</div>\n</div>\n'),t.put("styles.tpl.html",'<div class="no-shrink p">\n\t<button class="topcoat-button" ng-click="newStyleSet()" uib-tooltip="Create a new set" tooltip-popup-delay="1000" tooltip-placement="bottom-left">\n\t\t<span class="glyphicon glyphicon-plus"></span>\n\t\t<!-- New -->\n\t</button>\n\t<button class="topcoat-button" ng-click="importStyleSet()" uib-tooltip="Import a set from a json file" tooltip-popup-delay="1000" tooltip-placement="bottom-left">\n\t\t<span class="glyphicon glyphicon-import"></span>\n\t\t<!-- Import -->\n\t</button>\n\t<button class="topcoat-button" ng-click="extendStyleSet()" uib-tooltip="Analyze a translation script and extend the current set with keywords found within it" tooltip-popup-delay="1000" tooltip-placement="bottom-left">\n\t\t<span class="glyphicon glyphicon-indent-right"></span>\n\t\t<!-- Extend -->\n\t</button>\n\t<button class="topcoat-button" ng-click="saveStyleSet()" uib-tooltip="Save current set" tooltip-popup-delay="1000" tooltip-placement="bottom">\n\t\t<span class="glyphicon glyphicon-floppy-disk"></span>\n\t\t<!-- Save -->\n\t</button>\n\t<button class="topcoat-button" ng-click="exportStyleSet()" ng-disabled="selectedStyleset == undefined" uib-tooltip="Export current set as a json file" tooltip-popup-delay="1000" tooltip-placement="bottom">\n\t\t<span class="glyphicon glyphicon-export"></span>\n\t\t<!-- Export -->\n\t</button>\n\t<button class="topcoat-button" ng-click="duplicateStyleSet()" ng-disabled="selectedStyleset == undefined" uib-tooltip="Duplicate current set\n\t" tooltip-popup-delay="1000" tooltip-placement="bottom">\n\t\t<span class="glyphicon glyphicon-duplicate"></span>\n\t\t<!-- Duplicate -->\n\t</button>\n\t<button class="topcoat-button" ng-click="deleteStyleSet()" ng-disabled="!!!selectedStyleset" uib-tooltip="Delete current set\n\t" tooltip-popup-delay="1000" tooltip-placement="bottom">\n\t\t<span class="glyphicon glyphicon-trash"></span>\n\t\t<!-- Delete -->\n\t</button>\n\t<styleset-selector selected-value="selectedStyleset"></styleset-selector>\n\n\t<div class="pull-right">\n\t\t<button class="topcoat-button" ng-click="actionSelectedLayers(\'toggleHyphenation\')" uib-tooltip="Toggle hyphenation on selected layers" tooltip-popup-delay="1000" tooltip-placement="bottom-right">\n\t\t\t<strong>H</strong><span class="glyphicon glyphicon-minus"></span>\n\t\t</button>\n\t\t<button class="topcoat-button" ng-click="actionSelectedLayers(\'toggleFauxBold\')" uib-tooltip="Toggle faux bold on selected layers" tooltip-popup-delay="1000" tooltip-placement="bottom-right">\n\t\t\t<span class="glyphicon glyphicon-bold"></span>\n\t\t</button>\n\t\t<button class="topcoat-button" ng-click="actionSelectedLayers(\'toggleFauxItalic\')" uib-tooltip="Toggle faux italic on selected layers" tooltip-popup-delay="1000" tooltip-placement="bottom-right">\n\t\t\t<span class="glyphicon glyphicon-italic"></span>\n\t\t</button>\n\t\t<button class="topcoat-button" ng-click="actionSelectedLayers(\'adjustFontSize\', -1)" uib-tooltip="Decrease font size by 1 pixel on selected layers" tooltip-popup-delay="1000" tooltip-placement="bottom-right">\n\t\t\t<span class="glyphicon glyphicon-text-height"></span>-\n\t\t</button>\n\t\t<button class="topcoat-button" ng-click="actionSelectedLayers(\'adjustFontSize\', 1)" uib-tooltip="Increase font size by 1 pixel on selected layers" tooltip-popup-delay="1000" tooltip-placement="bottom-right">\n\t\t\t<span class="glyphicon glyphicon-text-height"></span>+\n\t\t</button>\n\t\t<button class="topcoat-button" ng-click="actionSelectedLayers(\'roundFontSize\')" uib-tooltip="Round font size on selected layers" tooltip-popup-delay="1000" tooltip-placement="bottom-right">\n\t\t\t<span class="glyphicon glyphicon-text-height"></span>o\n\t\t</button>\n\t\t<button class="topcoat-button" ng-click="actionSelectedLayers(\'autoResize\')" uib-tooltip="Auto resize selected layers" tooltip-popup-delay="500" tooltip-placement="bottom-right">\n\t\t\t<span class="glyphicon glyphicon-resize-small"></span>\n\t\t</button>\n\t</div>\n</div>\n\n<div class="row no-shrink pb header">\n\t<div class="col-md-4 col-xs-4">\n\t\t<label>\n\t\t\tName\n\t\t\t<input type="text" class="topcoat-text-input" placeholder="Styleset name" ng-model="styleSet.name" ng-disabled="selectedStyleset === 0" ng-pattern="/[\\d\\w]{1,30}/">\n\t\t</label>\n\t</div>\n\t<div class="col-md-5 col-xs-5">\n\t\t<label>\n\t\t\tStyle filter\n\t\t\t<input type="text" class="topcoat-text-input" placeholder="filter..." ng-model="styleFilter">\n\t\t</label>\n\t\t<button class="topcoat-button" ng-click="clearStyleFilter()" ng-if="!!styleFilter">\n\t\t\t<span class="glyphicon glyphicon-remove"></span>\n\t\t</button>\n\t</div>\n\t<div class="col-md-3 col-xs-3 text-right">\n\t\t<button class="topcoat-button" ng-click="addStyle()">Add Style</button>\n\t</div>\n</div>\n<div class="list scrollable padded">\n\t<div class="list-item" ng-repeat="style in styleSet.styles |filter: {keyword: styleFilter||undefined}">\n\t\t<tb-style-preset preset="style" remove-action="removeStyle(style)" duplicate-action="duplicateStyle(style)" apply-action="applyStyleSelectedLayers(style, resize)" set-action="setStyle(style)" ng-class="{\'default-style\': style.default}"></tb-style-preset>\n\t</div>\n</div>\n<div class="row no-shrink pv">\n\t<div class="col-md-4 col-xs-4">\n\t\t<button class="topcoat-button" ng-click="exportStyleProps()" uib-tooltip="Export available fonts and style properties" tooltip-popup-delay="1000" tooltip-placement="top-left">\n\t\t\t<span class="glyphicon glyphicon-book"></span>\n\t\t</button>\n\t</div>\n\t<div class="col-md-5 col-xs-5">\n\n\t</div>\n\t<div class="col-md-3 col-xs-3 text-right">\n\t\t<button class="topcoat-button" ng-click="addStyle()">Add Style</button>\n\t</div>\n</div>\n'),t.put("text_replacer.tpl.html",'<div class="row no-shrink p header">\n\t<div class="col-lg-4 col-md-4 col-xs-4 text-center">\n\t\tPattern\n\t</div>\n\t<div class="col-lg-1 col-md-1 col-xs-1 text-center">\n\t\tRegExp\n\t</div>\n\t<div class="col-lg-4 col-md-4 col-xs-4 text-center">\n\t\tReplace with\n\t</div>\n\t<div class="col-lg-3 col-md-3 col-xs-3 flex between">\n\t\t<button class="topcoat-button" ng-click="addRule()">\n\t\t\t<span class="glyphicon glyphicon-plus"></span>\n\t\t</button>\n\t\t<span>Order</span>\n\t\t<span>Active</span>\n\t</div>\n</div>\n<div class="list scrollable pt">\n\t<div class="row pb" ng-repeat="rule in textReplaceRules">\n\t\t<div class="col-lg-4 col-md-4 col-xs-4 flex between">\n\t\t\t<span ng-if="rule.regex">/</span>\n\t\t\t<input type="text" class="topcoat-text-input" ng-model="rule.pattern" ng-class="{\'full-width\': !rule.regex}">\n\t\t\t<span ng-if="rule.regex">/</span>\n\t\t\t<label class="topcoat-checkbox" ng-if="rule.regex" uib-tooltip="Global (replace all matches)" tooltip-popup-delay="500" tooltip-placement="bottom">\n\t\t\t\t<input type="checkbox" class="topcoat-checkbox" ng-model="rule.regexG">\n\t\t\t\t<div class="topcoat-checkbox__checkmark"></div>\n\t\t\t\tg\n\t\t\t</label>\n\t\t\t<label class="topcoat-checkbox" ng-if="rule.regex" uib-tooltip="Case insensitive" tooltip-popup-delay="500" tooltip-placement="bottom">\n\t\t\t\t<input type="checkbox" class="topcoat-checkbox" ng-model="rule.regexI">\n\t\t\t\t<div class="topcoat-checkbox__checkmark"></div>\n\t\t\t\ti\n\t\t\t</label>\n\t\t</div>\n\t\t<div class="col-lg-1 col-md-1 col-xs-1 flex around">\n\t\t\t<label class="topcoat-checkbox" uib-tooltip="Pattern is a regular expression" tooltip-popup-delay="500" tooltip-placement="bottom">\n\t\t\t\t<input type="checkbox" class="topcoat-checkbox" ng-model="rule.regex">\n\t\t\t\t<div class="topcoat-checkbox__checkmark"></div>\n\t\t\t</label>\n\t\t</div>\n\t\t<div class="col-lg-4 col-md-4 col-xs-4">\n\t\t\t<input type="text" class="topcoat-text-input full-width" ng-model="rule.to">\n\t\t</div>\n\t\t<div class="col-lg-3 col-md-3 col-xs-3 flex between">\n\t\t\t<button class="topcoat-button" ng-click="removeRule(rule)">\n\t\t\t\t<span class="glyphicon glyphicon-trash"></span>\n\t\t\t</button>\n\t\t\t<button class="topcoat-button" ng-click="moveRule(rule, true)">\n\t\t\t\t<span class="glyphicon glyphicon-arrow-up"></span>\n\t\t\t</button>\n\t\t\t<button class="topcoat-button" ng-click="moveRule(rule)">\n\t\t\t\t<span class="glyphicon glyphicon-arrow-down"></span>\n\t\t\t</button>\n\t\t\t<label class="topcoat-switch">\n\t\t\t\t<input type="checkbox" ng-model="rule.active" ng-true-value="true" class="topcoat-switch__input">\n\t\t\t\t<div class="topcoat-switch__toggle"></div>\n\t\t\t</label>\n\t\t</div>\n\t</div>\n</div>\n\n<div class="row no-shrink pv">\n\t<div class="col-md-9 col-xs-9">\n\t\t<button class="topcoat-button" ng-click="appendDefaults()">\n\t\t\tAppend default rules\n\t\t</button>\n\t\t<button class="topcoat-button" ng-click="importRules()" uib-tooltip="Import rules from a json file" tooltip-popup-delay="1000" tooltip-placement="top">\n\t\t\t<span class="glyphicon glyphicon-import"></span>\n\t\t</button>\n\t\t<button class="topcoat-button" ng-click="exportRules()" ng-disabled="!!!textReplaceRules" uib-tooltip="Export rules as a json file" tooltip-popup-delay="1000" tooltip-placement="top">\n\t\t\t<span class="glyphicon glyphicon-export"></span>\n\t\t</button>\n\t</div>\n\t<div class="col-md-3 col-xs-3 text-right">\n\t\t<button class="topcoat-button" ng-click="addRule()">Add Rule</button>\n\t</div>\n</div>\n')}]);